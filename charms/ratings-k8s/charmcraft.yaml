# Copyright 2024 Canonical Ltd.
# See LICENSE file for licensing details.

name: ratings-k8s
type: charm
summary: Ratings microservice for the Bookinfo application
description: |
  The Ratings microservice provides book ratings information
  for the Bookinfo sample application.

links:
  documentation: https://github.com/adhityaravi/bookinfo-k8s-charm
  source: https://github.com/adhityaravi/bookinfo-k8s-charm
  issues: https://github.com/adhityaravi/bookinfo-k8s-charm/issues

assumes:
  - k8s-api
  - juju >= 3.6

platforms:
  ubuntu@22.04:amd64:

parts:
  charm:
    source: .
    plugin: uv
    build-packages: [git]
    build-snaps: [astral-uv]
    override-build: |
      craftctl default
      git -C ../../ describe --always > $CRAFT_PART_INSTALL/version

containers:
  ratings:
    resource: ratings-image
    mounts:
      - storage: logs
        location: /tmp/logs

storage:
  logs:
    type: filesystem

provides:
  ratings:
    interface: bookinfo-ratings

requires:
  database:
    interface: mongodb_client
    limit: 1
    optional: true

resources:
  ratings-image:
    type: oci-image
    description: OCI image for the Ratings service
    upstream-source: docker.io/istio/examples-bookinfo-ratings-v1:1.20.3

config:
  options:
    port:
      default: 9080
      description: Port on which the Ratings service listens
      type: int
    log-level:
      default: info
      description: Application log level (debug, info, warning, error)
      type: string
    db-type:
      default: mysql
      description: Database type to use (mysql or mongodb)
      type: string